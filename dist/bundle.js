(()=>{"use strict";class e{constructor(e,t,n,r){this.attach=e=>{this.hostElement.insertAdjacentElement(e?"afterbegin":"beforeend",this.element)},this.templateElement=document.getElementById(e),this.hostElement=document.getElementById(t);const s=document.importNode(this.templateElement.content,!0);this.element=s.firstElementChild,r&&(this.element.id=r),this.attach(n)}}const t=(e,t,n)=>{const r=n.value;return{configurable:!0,get(){return r.bind(this)}}},n=e=>{let t=!0;return e.required&&(t=t&&0!==e.value.toString().trim().length),null!=e.minLength&&"string"==typeof e.value&&(t=t&&e.value.length>=e.minLength),null!=e.maxLength&&"string"==typeof e.value&&(t=t&&e.value.length<=e.maxLength),null!=e.min&&"number"==typeof e.value&&(t=t&&e.value>=e.min),null!=e.max&&"number"==typeof e.value&&(t=t&&e.value<=e.max),t};var r;!function(e){e[e.Active=0]="Active",e[e.Finished=1]="Finished"}(r||(r={}));class s{constructor(e,t,n,r,s){this.id=e,this.title=t,this.description=n,this.people=r,this.status=s}}class i extends class{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}{constructor(){super(),this.projects=[]}static getInstance(){return this.instance||(this.instance=new i),this.instance}addProject(e,t,n){const i=new s(Math.random().toString(),e,t,n,r.Active);this.projects.push(i),this.updateListeners()}moveProject(e,t){const n=this.projects.find((t=>t.id===e));n&&n.status!==t&&(n.status=t,this.updateListeners())}updateListeners(){for(const e of this.listeners)e(this.projects.slice())}}const l=i.getInstance();class o extends e{constructor(){super("project-input","app",!0,"user-input"),this.configure=()=>{this.element.addEventListener("submit",this.submitHandler)},this.gatherUserInput=()=>{const e=this.titleInputElement.value,t=this.descriptionInputElement.value,r=this.peopleInputElement.value,s={value:t,required:!0,minLength:5},i={value:+r,required:!0,min:1,max:5};return n({value:e,required:!0})&&n(s)&&n(i)?[e,t,+r]:void alert("Invalid input, please try again!")},this.clearInputs=()=>{this.titleInputElement.value="",this.descriptionInputElement.value="",this.peopleInputElement.value=""},this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.peopleInputElement=this.element.querySelector("#people"),this.configure()}renderContent(){}submitHandler(e){e.preventDefault();const t=this.gatherUserInput();if(Array.isArray(t)){const[e,n,r]=t;l.addProject(e,n,r),console.log(e,n,r),this.clearInputs()}}}!function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);i>3&&l&&Object.defineProperty(t,n,l)}([t],o.prototype,"submitHandler",null);class a extends e{constructor(e,t){super("single-project",e,!1,t.id),this.project=t,this.configure(),this.renderContent()}get persons(){return 1===this.project.people?"1 person":`${this.project.people} persons`}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.project.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){console.log("DragEnd")}configure(){this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.persons+" assigned",this.element.querySelector("p").textContent=this.project.description}}!function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);i>3&&l&&Object.defineProperty(t,n,l)}([t],a.prototype,"dragStartHandler",null);var c=function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l};class d extends e{constructor(e){super("project-list","app",!1,`${e}-projects`),this.type=e,this.configure=()=>{this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),this.element.addEventListener("drop",this.dropHandler),l.addListener((e=>{const t=e.filter((e=>"active"===this.type?e.status===r.Active:e.status===r.Finished));this.assignedProjects=t,this.renderProjects()}))},this.renderContent=()=>{const e=`${this.type}-projects-list`;this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent=this.type.toUpperCase()+"PROJECTS"},this.assignedProjects=[],this.configure(),this.renderContent()}dragOverHandler(e){e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]&&(e.preventDefault(),this.element.querySelector("ul").classList.add("droppable"))}dropHandler(e){const t=e.dataTransfer.getData("text/plain");l.moveProject(t,"active"===this.type?r.Active:r.Finished)}dragLeaveHandler(e){this.element.querySelector("ul").classList.remove("droppable")}renderProjects(){document.getElementById(`${this.type}-projects-list`).innerHTML="";for(const e of this.assignedProjects)new a(this.element.querySelector("ul").id,e)}}c([t],d.prototype,"dragOverHandler",null),c([t],d.prototype,"dropHandler",null),c([t],d.prototype,"dragLeaveHandler",null),new o,new d("active"),new d("finished")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly91bmRlcnN0YW5kaW5ndHlwZXNjcmlwdC8uL3NyYy9jb21wb25lbnRzL2Jhc2UtY29tcG9uZW50LnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmd0eXBlc2NyaXB0Ly4vc3JjL2RlY29yYXRvcnMvYXV0b2JpbmQudHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZ3R5cGVzY3JpcHQvLi9zcmMvdXRpbC92YWxpZGF0aW9uLnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmd0eXBlc2NyaXB0Ly4vc3JjL21vZGVscy9wcm9qZWN0LnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmd0eXBlc2NyaXB0Ly4vc3JjL3N0YXRlL3Byb2plY3Qtc3RhdGUudHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZ3R5cGVzY3JpcHQvLi9zcmMvY29tcG9uZW50cy9wcm9qZWN0LWlucHV0LnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmd0eXBlc2NyaXB0Ly4vc3JjL2NvbXBvbmVudHMvcHJvamVjdC1pdGVtLnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmd0eXBlc2NyaXB0Ly4vc3JjL2NvbXBvbmVudHMvcHJvamVjdC1saXN0LnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmd0eXBlc2NyaXB0Ly4vc3JjL2FwcC50cyJdLCJuYW1lcyI6WyJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInRlbXBsYXRlSWQiLCJob3N0RWxlbWVudElkIiwiaW5zZXJ0QXRTdGFydCIsIm5ld0VsZW1lbnRJZCIsImF0dGFjaCIsImluc2VydEF0QmVnaW5uaW5nIiwidGhpcyIsImhvc3RFbGVtZW50IiwiaW5zZXJ0QWRqYWNlbnRFbGVtZW50IiwiZWxlbWVudCIsInRlbXBsYXRlRWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbXBvcnRlZE5vZGUiLCJpbXBvcnROb2RlIiwiY29udGVudCIsImZpcnN0RWxlbWVudENoaWxkIiwiaWQiLCJhdXRvYmluZCIsIl8iLCJfMiIsImRlc2NyaXB0b3IiLCJvcmlnaW5hbE1ldGhvZCIsInZhbHVlIiwiY29uZmlndXJhYmxlIiwiZ2V0IiwiYmluZCIsInZhbGlkYXRlIiwidmFsaWRhdGFibGVJbnB1dCIsImlzVmFsaWQiLCJyZXF1aXJlZCIsInRvU3RyaW5nIiwidHJpbSIsImxlbmd0aCIsIm1pbkxlbmd0aCIsIm1heExlbmd0aCIsIm1pbiIsIm1heCIsIlByb2plY3RTdGF0dXMiLCJQcm9qZWN0IiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsInBlb3BsZSIsInN0YXR1cyIsIlByb2plY3RTdGF0ZSIsImxpc3RlbmVycyIsImFkZExpc3RlbmVyIiwibGlzdGVuZXJGbiIsInB1c2giLCJzdXBlciIsInByb2plY3RzIiwiaW5zdGFuY2UiLCJhZGRQcm9qZWN0IiwibnVtT2ZQZW9wbGUiLCJuZXdQcm9qZWN0IiwiTWF0aCIsInJhbmRvbSIsIkFjdGl2ZSIsInVwZGF0ZUxpc3RlbmVycyIsIm1vdmVQcm9qZWN0IiwicHJvamVjdElkIiwibmV3U3RhdHVzIiwicHJvamVjdCIsImZpbmQiLCJwcmoiLCJzbGljZSIsInByb2plY3RTdGF0ZSIsImdldEluc3RhbmNlIiwiUHJvamVjdElucHV0IiwiY29uZmlndXJlIiwiYWRkRXZlbnRMaXN0ZW5lciIsInN1Ym1pdEhhbmRsZXIiLCJnYXRoZXJVc2VySW5wdXQiLCJlbnRlcmVkVGl0bGUiLCJ0aXRsZUlucHV0RWxlbWVudCIsImVudGVyZWREZXNjcmlwdGlvbiIsImRlc2NyaXB0aW9uSW5wdXRFbGVtZW50IiwiZW50ZXJlZFBlb3BsZSIsInBlb3BsZUlucHV0RWxlbWVudCIsImRlc2NyaXB0aW9uVmFsaWRhdGFibGUiLCJwZW9wbGVWYWxpZGF0YWJsZSIsImFsZXJ0IiwiY2xlYXJJbnB1dHMiLCJxdWVyeVNlbGVjdG9yIiwicmVuZGVyQ29udGVudCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJ1c2VySW5wdXQiLCJBcnJheSIsImlzQXJyYXkiLCJkZXNjIiwiY29uc29sZSIsImxvZyIsIlByb2plY3RJdGVtIiwiaG9zdElkIiwiZHJhZ1N0YXJ0SGFuZGxlciIsImRhdGFUcmFuc2ZlciIsInNldERhdGEiLCJlZmZlY3RBbGxvd2VkIiwiZHJhZ0VuZEhhbmRsZXIiLCJ0ZXh0Q29udGVudCIsInBlcnNvbnMiLCJQcm9qZWN0TGlzdCIsInR5cGUiLCJkcmFnT3ZlckhhbmRsZXIiLCJkcmFnTGVhdmVIYW5kbGVyIiwiZHJvcEhhbmRsZXIiLCJyZWxldmFudFByb2plY3RzIiwiZmlsdGVyIiwiRmluaXNoZWQiLCJhc3NpZ25lZFByb2plY3RzIiwicmVuZGVyUHJvamVjdHMiLCJsaXN0SWQiLCJ0b1VwcGVyQ2FzZSIsInR5cGVzIiwiY2xhc3NMaXN0IiwiYWRkIiwicHJqSWQiLCJnZXREYXRhIiwicmVtb3ZlIiwiaW5uZXJIVE1MIiwicHJqSXRlbSJdLCJtYXBwaW5ncyI6Im1CQUNpQixNQUFlQSxFQUs1QkMsWUFBWUMsRUFBb0JDLEVBQXVCQyxFQUF3QkMsR0FZdkUsS0FBQUMsT0FBVUMsSUFDaEJDLEtBQUtDLFlBQVlDLHNCQUFzQkgsRUFBb0IsYUFBZSxZQUFhQyxLQUFLRyxVQVo1RkgsS0FBS0ksZ0JBQWtCQyxTQUFTQyxlQUFlWixHQUMvQ00sS0FBS0MsWUFBY0ksU0FBU0MsZUFBZVgsR0FFM0MsTUFBTVksRUFBZUYsU0FBU0csV0FBV1IsS0FBS0ksZ0JBQWdCSyxTQUFTLEdBQ3ZFVCxLQUFLRyxRQUFVSSxFQUFhRyxrQkFDeEJiLElBQ0ZHLEtBQUtHLFFBQVFRLEdBQUtkLEdBRXBCRyxLQUFLRixPQUFPRixJQ2JULE1BQU1nQixFQUFXLENBQUNDLEVBQVFDLEVBQVlDLEtBQzNDLE1BQU1DLEVBQWlCRCxFQUFXRSxNQVFsQyxNQVAwQyxDQUN4Q0MsY0FBYyxFQUNkQyxNQUVFLE9BRGdCSCxFQUFlSSxLQUFLcEIsU0NJN0JxQixFQUFZQyxJQUN2QixJQUFJQyxHQUFVLEVBZ0JkLE9BZklELEVBQWlCRSxXQUNuQkQsRUFBVUEsR0FBK0QsSUFBcERELEVBQWlCTCxNQUFNUSxXQUFX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Y0FBYyxNQUFPbEUsR0FBSXdHLElBL0MxRCxHQURDdkcsRyxvQ0FVRCxHQURDQSxHLGdDQU9ELEdBRENBLEcscUNDL0JILElBQUlrRCxFQUNKLElBQUlrQyxFQUFZLFVBQ2hCLElBQUlBLEVBQVksYSIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb21wb25lbnQgQmFzZSBDbGFzc1xyXG4gIGV4cG9ydCBkZWZhdWx0IGFic3RyYWN0IGNsYXNzIENvbXBvbmVudDxUIGV4dGVuZHMgSFRNTEVsZW1lbnQsIFUgZXh0ZW5kcyBIVE1MRWxlbWVudD4ge1xyXG4gICAgdGVtcGxhdGVFbGVtZW50OiBIVE1MVGVtcGxhdGVFbGVtZW50O1xyXG4gICAgaG9zdEVsZW1lbnQ6IFQ7XHJcbiAgICBlbGVtZW50OiBVO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHRlbXBsYXRlSWQ6IHN0cmluZywgaG9zdEVsZW1lbnRJZDogc3RyaW5nLCBpbnNlcnRBdFN0YXJ0OiBib29sZWFuLCBuZXdFbGVtZW50SWQ/OiBzdHJpbmcpIHtcclxuICAgICAgdGhpcy50ZW1wbGF0ZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0ZW1wbGF0ZUlkKSEgYXMgSFRNTFRlbXBsYXRlRWxlbWVudDtcclxuICAgICAgdGhpcy5ob3N0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGhvc3RFbGVtZW50SWQpISBhcyBUO1xyXG5cclxuICAgICAgY29uc3QgaW1wb3J0ZWROb2RlID0gZG9jdW1lbnQuaW1wb3J0Tm9kZSh0aGlzLnRlbXBsYXRlRWxlbWVudC5jb250ZW50LCB0cnVlKTtcclxuICAgICAgdGhpcy5lbGVtZW50ID0gaW1wb3J0ZWROb2RlLmZpcnN0RWxlbWVudENoaWxkIGFzIFU7XHJcbiAgICAgIGlmIChuZXdFbGVtZW50SWQpIHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQuaWQgPSBuZXdFbGVtZW50SWQ7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5hdHRhY2goaW5zZXJ0QXRTdGFydCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhdHRhY2ggPSAoaW5zZXJ0QXRCZWdpbm5pbmc6IGJvb2xlYW4pID0+IHtcclxuICAgICAgdGhpcy5ob3N0RWxlbWVudC5pbnNlcnRBZGphY2VudEVsZW1lbnQoaW5zZXJ0QXRCZWdpbm5pbmcgPyBcImFmdGVyYmVnaW5cIiA6IFwiYmVmb3JlZW5kXCIsIHRoaXMuZWxlbWVudCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGFic3RyYWN0IGNvbmZpZ3VyZSgpOiB2b2lkO1xyXG4gICAgYWJzdHJhY3QgcmVuZGVyQ29udGVudCgpOiB2b2lkO1xyXG4gIH1cclxuXHJcbiIsIlxyXG4gICAgICAvLyBhdXRvYmluZCBkZWNvcmF0b3JcclxuICBleHBvcnQgY29uc3QgYXV0b2JpbmQgPSAoXzogYW55LCBfMjogc3RyaW5nLCBkZXNjcmlwdG9yOiBQcm9wZXJ0eURlc2NyaXB0b3IpID0+IHtcclxuICAgIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gZGVzY3JpcHRvci52YWx1ZTtcclxuICAgIGNvbnN0IGFkakRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvciA9IHtcclxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxyXG4gICAgICBnZXQoKSB7XHJcbiAgICAgICAgY29uc3QgYm91bmRGbiA9IG9yaWdpbmFsTWV0aG9kLmJpbmQodGhpcyk7XHJcbiAgICAgICAgcmV0dXJuIGJvdW5kRm47XHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGFkakRlc2NyaXB0b3I7XHJcbiAgfTtcclxuIiwiXHJcbiAgICAgLy8gdmFsaWRhdGlvblxyXG4gIGV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdGFibGUge1xyXG4gICAgdmFsdWU6IHN0cmluZyB8IG51bWJlcjtcclxuICAgIHJlcXVpcmVkPzogYm9vbGVhbjtcclxuICAgIG1pbkxlbmd0aD86IG51bWJlcjtcclxuICAgIG1heExlbmd0aD86IG51bWJlcjtcclxuICAgIG1pbj86IG51bWJlcjtcclxuICAgIG1heD86IG51bWJlcjtcclxuICB9XHJcblxyXG4gIGV4cG9ydCBjb25zdCB2YWxpZGF0ZSA9ICh2YWxpZGF0YWJsZUlucHV0OiBWYWxpZGF0YWJsZSkgPT4ge1xyXG4gICAgbGV0IGlzVmFsaWQgPSB0cnVlO1xyXG4gICAgaWYgKHZhbGlkYXRhYmxlSW5wdXQucmVxdWlyZWQpIHtcclxuICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZS50b1N0cmluZygpLnRyaW0oKS5sZW5ndGggIT09IDA7XHJcbiAgICB9XHJcbiAgICBpZiAodmFsaWRhdGFibGVJbnB1dC5taW5MZW5ndGggIT0gbnVsbCAmJiB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICBpc1ZhbGlkID0gaXNWYWxpZCAmJiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlLmxlbmd0aCA+PSB2YWxpZGF0YWJsZUlucHV0Lm1pbkxlbmd0aDtcclxuICAgIH1cclxuICAgIGlmICh2YWxpZGF0YWJsZUlucHV0Lm1heExlbmd0aCAhPSBudWxsICYmIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUubGVuZ3RoIDw9IHZhbGlkYXRhYmxlSW5wdXQubWF4TGVuZ3RoO1xyXG4gICAgfVxyXG4gICAgaWYgKHZhbGlkYXRhYmxlSW5wdXQubWluICE9IG51bGwgJiYgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09IFwibnVtYmVyXCIpIHtcclxuICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA+PSB2YWxpZGF0YWJsZUlucHV0Lm1pbjtcclxuICAgIH1cclxuICAgIGlmICh2YWxpZGF0YWJsZUlucHV0Lm1heCAhPSBudWxsICYmIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID09PSBcIm51bWJlclwiKSB7XHJcbiAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPD0gdmFsaWRhdGFibGVJbnB1dC5tYXg7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaXNWYWxpZDtcclxuICB9OyIsIlxyXG4gIC8vIFByb2plY3QgVHlwZVxyXG4gIGV4cG9ydCBlbnVtIFByb2plY3RTdGF0dXMge1xyXG4gICAgQWN0aXZlLFxyXG4gICAgRmluaXNoZWQsXHJcbiAgfVxyXG4gIGV4cG9ydCBjbGFzcyBQcm9qZWN0IHtcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBpZDogc3RyaW5nLCBwdWJsaWMgdGl0bGU6IHN0cmluZywgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcsIHB1YmxpYyBwZW9wbGU6IG51bWJlciwgcHVibGljIHN0YXR1czogUHJvamVjdFN0YXR1cykge31cclxuICB9XHJcblxyXG4iLCJpbXBvcnQgeyBQcm9qZWN0LCBQcm9qZWN0U3RhdHVzIH0gZnJvbSBcIi4uL21vZGVscy9wcm9qZWN0XCI7XHJcblxyXG4vLyBQcm9qZWN0IFN0YXRlIE1hbmFnZW1lbnRcclxudHlwZSBMaXN0ZW5lcjxUPiA9IChpdGVtczogVFtdKSA9PiB2b2lkO1xyXG5cclxuY2xhc3MgU3RhdGU8VD4ge1xyXG4gIHByb3RlY3RlZCBsaXN0ZW5lcnM6IExpc3RlbmVyPFQ+W10gPSBbXTtcclxuXHJcbiAgYWRkTGlzdGVuZXIobGlzdGVuZXJGbjogTGlzdGVuZXI8VD4pIHtcclxuICAgIHRoaXMubGlzdGVuZXJzLnB1c2gobGlzdGVuZXJGbik7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgUHJvamVjdFN0YXRlIGV4dGVuZHMgU3RhdGU8UHJvamVjdD4ge1xyXG4gIHByaXZhdGUgcHJvamVjdHM6IFByb2plY3RbXSA9IFtdO1xyXG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBQcm9qZWN0U3RhdGU7XHJcblxyXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlcigpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGdldEluc3RhbmNlKCkge1xyXG4gICAgaWYgKHRoaXMuaW5zdGFuY2UpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XHJcbiAgICB9XHJcbiAgICB0aGlzLmluc3RhbmNlID0gbmV3IFByb2plY3RTdGF0ZSgpO1xyXG4gICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XHJcbiAgfVxyXG5cclxuICBhZGRQcm9qZWN0KHRpdGxlOiBzdHJpbmcsIGRlc2NyaXB0aW9uOiBzdHJpbmcsIG51bU9mUGVvcGxlOiBudW1iZXIpIHtcclxuICAgIGNvbnN0IG5ld1Byb2plY3QgPSBuZXcgUHJvamVjdChNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKCksIHRpdGxlLCBkZXNjcmlwdGlvbiwgbnVtT2ZQZW9wbGUsIFByb2plY3RTdGF0dXMuQWN0aXZlKTtcclxuICAgIHRoaXMucHJvamVjdHMucHVzaChuZXdQcm9qZWN0KTtcclxuICAgIHRoaXMudXBkYXRlTGlzdGVuZXJzKCk7XHJcbiAgfVxyXG5cclxuICBtb3ZlUHJvamVjdChwcm9qZWN0SWQ6IHN0cmluZywgbmV3U3RhdHVzOiBQcm9qZWN0U3RhdHVzKSB7XHJcbiAgICBjb25zdCBwcm9qZWN0ID0gdGhpcy5wcm9qZWN0cy5maW5kKChwcmopID0+IHByai5pZCA9PT0gcHJvamVjdElkKTtcclxuICAgIGlmIChwcm9qZWN0ICYmIHByb2plY3Quc3RhdHVzICE9PSBuZXdTdGF0dXMpIHtcclxuICAgICAgcHJvamVjdC5zdGF0dXMgPSBuZXdTdGF0dXM7XHJcbiAgICAgIHRoaXMudXBkYXRlTGlzdGVuZXJzKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHVwZGF0ZUxpc3RlbmVycygpIHtcclxuICAgIGZvciAoY29uc3QgbGlzdGVuZXJGbiBvZiB0aGlzLmxpc3RlbmVycykge1xyXG4gICAgICBsaXN0ZW5lckZuKHRoaXMucHJvamVjdHMuc2xpY2UoKSk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgcHJvamVjdFN0YXRlID0gUHJvamVjdFN0YXRlLmdldEluc3RhbmNlKCk7XHJcbiIsImltcG9ydCBDb21wb25lbnQgZnJvbSBcIi4vYmFzZS1jb21wb25lbnRcIjtcclxuaW1wb3J0IHsgYXV0b2JpbmQgYXMgQXV0b2JpbmQgfSBmcm9tIFwiLi4vZGVjb3JhdG9ycy9hdXRvYmluZFwiO1xyXG5pbXBvcnQgKiBhcyBWYWxpZGF0aW9uIGZyb20gXCIuLi91dGlsL3ZhbGlkYXRpb25cIjtcclxuaW1wb3J0IHsgcHJvamVjdFN0YXRlIH0gZnJvbSBcIi4uL3N0YXRlL3Byb2plY3Qtc3RhdGVcIjtcclxuXHJcbi8vIFByb2plY3QgQ2xhc3NcclxuZXhwb3J0IGNsYXNzIFByb2plY3RJbnB1dCBleHRlbmRzIENvbXBvbmVudDxIVE1MRGl2RWxlbWVudCwgSFRNTEZvcm1FbGVtZW50PiB7XHJcbiAgdGl0bGVJbnB1dEVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgcGVvcGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKFwicHJvamVjdC1pbnB1dFwiLCBcImFwcFwiLCB0cnVlLCBcInVzZXItaW5wdXRcIik7XHJcbiAgICB0aGlzLnRpdGxlSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjdGl0bGVcIikgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgIHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZXNjcmlwdGlvblwiKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgdGhpcy5wZW9wbGVJbnB1dEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcIiNwZW9wbGVcIikgYXMgSFRNTElucHV0RWxlbWVudDtcclxuXHJcbiAgICB0aGlzLmNvbmZpZ3VyZSgpO1xyXG4gIH1cclxuXHJcbiAgY29uZmlndXJlID0gKCkgPT4ge1xyXG4gICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5zdWJtaXRIYW5kbGVyKTtcclxuICB9O1xyXG5cclxuICByZW5kZXJDb250ZW50KCkge31cclxuXHJcbiAgcHJpdmF0ZSBnYXRoZXJVc2VySW5wdXQgPSAoKTogW3N0cmluZywgc3RyaW5nLCBudW1iZXJdIHwgdm9pZCA9PiB7XHJcbiAgICBjb25zdCBlbnRlcmVkVGl0bGUgPSB0aGlzLnRpdGxlSW5wdXRFbGVtZW50LnZhbHVlO1xyXG4gICAgY29uc3QgZW50ZXJlZERlc2NyaXB0aW9uID0gdGhpcy5kZXNjcmlwdGlvbklucHV0RWxlbWVudC52YWx1ZTtcclxuICAgIGNvbnN0IGVudGVyZWRQZW9wbGUgPSB0aGlzLnBlb3BsZUlucHV0RWxlbWVudC52YWx1ZTtcclxuXHJcbiAgICBjb25zdCB0aXRsZVZhbGlkYXRhYmxlOiBWYWxpZGF0aW9uLlZhbGlkYXRhYmxlID0ge1xyXG4gICAgICB2YWx1ZTogZW50ZXJlZFRpdGxlLFxyXG4gICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgIH07XHJcbiAgICBjb25zdCBkZXNjcmlwdGlvblZhbGlkYXRhYmxlOiBWYWxpZGF0aW9uLlZhbGlkYXRhYmxlID0ge1xyXG4gICAgICB2YWx1ZTogZW50ZXJlZERlc2NyaXB0aW9uLFxyXG4gICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgbWluTGVuZ3RoOiA1LFxyXG4gICAgfTtcclxuICAgIGNvbnN0IHBlb3BsZVZhbGlkYXRhYmxlOiBWYWxpZGF0aW9uLlZhbGlkYXRhYmxlID0ge1xyXG4gICAgICB2YWx1ZTogK2VudGVyZWRQZW9wbGUsXHJcbiAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgICBtaW46IDEsXHJcbiAgICAgIG1heDogNSxcclxuICAgIH07XHJcblxyXG4gICAgaWYgKCFWYWxpZGF0aW9uLnZhbGlkYXRlKHRpdGxlVmFsaWRhdGFibGUpIHx8ICFWYWxpZGF0aW9uLnZhbGlkYXRlKGRlc2NyaXB0aW9uVmFsaWRhdGFibGUpIHx8ICFWYWxpZGF0aW9uLnZhbGlkYXRlKHBlb3BsZVZhbGlkYXRhYmxlKSkge1xyXG4gICAgICBhbGVydChcIkludmFsaWQgaW5wdXQsIHBsZWFzZSB0cnkgYWdhaW4hXCIpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gW2VudGVyZWRUaXRsZSwgZW50ZXJlZERlc2NyaXB0aW9uLCArZW50ZXJlZFBlb3BsZV07XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSBjbGVhcklucHV0cyA9ICgpID0+IHtcclxuICAgICh0aGlzLnRpdGxlSW5wdXRFbGVtZW50LnZhbHVlID0gXCJcIiksICh0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50LnZhbHVlID0gXCJcIiksICh0aGlzLnBlb3BsZUlucHV0RWxlbWVudC52YWx1ZSA9IFwiXCIpO1xyXG4gIH07XHJcblxyXG4gIEBBdXRvYmluZFxyXG4gIHByaXZhdGUgc3VibWl0SGFuZGxlcihldmVudDogRXZlbnQpIHtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBjb25zdCB1c2VySW5wdXQgPSB0aGlzLmdhdGhlclVzZXJJbnB1dCgpO1xyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkodXNlcklucHV0KSkge1xyXG4gICAgICBjb25zdCBbdGl0bGUsIGRlc2MsIHBlb3BsZV0gPSB1c2VySW5wdXQ7XHJcbiAgICAgIHByb2plY3RTdGF0ZS5hZGRQcm9qZWN0KHRpdGxlLCBkZXNjLCBwZW9wbGUpO1xyXG4gICAgICBjb25zb2xlLmxvZyh0aXRsZSwgZGVzYywgcGVvcGxlKTtcclxuICAgICAgdGhpcy5jbGVhcklucHV0cygpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBEcmFnZ2FibGUgfSBmcm9tIFwiLi4vbW9kZWxzL2RyYWctZHJvcFwiO1xyXG5pbXBvcnQgQ29tcG9uZW50IGZyb20gXCIuL2Jhc2UtY29tcG9uZW50XCI7XHJcbmltcG9ydCB7IFByb2plY3QgfSBmcm9tIFwiLi4vbW9kZWxzL3Byb2plY3RcIjtcclxuaW1wb3J0IHsgYXV0b2JpbmQgfSBmcm9tIFwiLi4vZGVjb3JhdG9ycy9hdXRvYmluZFwiO1xyXG5cclxuLy8gUHJvamVjdGl0ZW0gQ2xhc3NcclxuZXhwb3J0IGNsYXNzIFByb2plY3RJdGVtIGV4dGVuZHMgQ29tcG9uZW50PEhUTUxVTGlzdEVsZW1lbnQsIEhUTUxMSUVsZW1lbnQ+IGltcGxlbWVudHMgRHJhZ2dhYmxlIHtcclxuICBwcml2YXRlIHByb2plY3Q6IFByb2plY3Q7XHJcblxyXG4gIGdldCBwZXJzb25zKCkge1xyXG4gICAgaWYgKHRoaXMucHJvamVjdC5wZW9wbGUgPT09IDEpIHtcclxuICAgICAgcmV0dXJuIFwiMSBwZXJzb25cIjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBgJHt0aGlzLnByb2plY3QucGVvcGxlfSBwZXJzb25zYDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKGhvc3RJZDogc3RyaW5nLCBwcm9qZWN0OiBQcm9qZWN0KSB7XHJcbiAgICBzdXBlcihcInNpbmdsZS1wcm9qZWN0XCIsIGhvc3RJZCwgZmFsc2UsIHByb2plY3QuaWQpO1xyXG4gICAgdGhpcy5wcm9qZWN0ID0gcHJvamVjdDtcclxuXHJcbiAgICB0aGlzLmNvbmZpZ3VyZSgpO1xyXG4gICAgdGhpcy5yZW5kZXJDb250ZW50KCk7XHJcbiAgfVxyXG5cclxuICBAYXV0b2JpbmRcclxuICBkcmFnU3RhcnRIYW5kbGVyKGV2ZW50OiBEcmFnRXZlbnQpIHtcclxuICAgIGV2ZW50LmRhdGFUcmFuc2ZlciEuc2V0RGF0YShcInRleHQvcGxhaW5cIiwgdGhpcy5wcm9qZWN0LmlkKTtcclxuICAgIGV2ZW50LmRhdGFUcmFuc2ZlciEuZWZmZWN0QWxsb3dlZCA9IFwibW92ZVwiO1xyXG4gIH1cclxuXHJcbiAgZHJhZ0VuZEhhbmRsZXIoXzogRHJhZ0V2ZW50KSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIkRyYWdFbmRcIik7XHJcbiAgfVxyXG5cclxuICBjb25maWd1cmUoKSB7XHJcbiAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdzdGFydFwiLCB0aGlzLmRyYWdTdGFydEhhbmRsZXIpO1xyXG4gICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnZW5kXCIsIHRoaXMuZHJhZ0VuZEhhbmRsZXIpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyQ29udGVudCgpIHtcclxuICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiaDJcIikhLnRleHRDb250ZW50ID0gdGhpcy5wcm9qZWN0LnRpdGxlO1xyXG4gICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJoM1wiKSEudGV4dENvbnRlbnQgPSB0aGlzLnBlcnNvbnMgKyBcIiBhc3NpZ25lZFwiO1xyXG4gICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJwXCIpIS50ZXh0Q29udGVudCA9IHRoaXMucHJvamVjdC5kZXNjcmlwdGlvbjtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IENvbXBvbmVudCBmcm9tIFwiLi9iYXNlLWNvbXBvbmVudFwiO1xyXG5pbXBvcnQgeyBhdXRvYmluZCB9IGZyb20gXCIuLi9kZWNvcmF0b3JzL2F1dG9iaW5kXCI7XHJcbmltcG9ydCB7IFByb2plY3QsIFByb2plY3RTdGF0dXMgfSBmcm9tIFwiLi4vbW9kZWxzL3Byb2plY3RcIjtcclxuaW1wb3J0IHsgRHJhZ1RhcmdldCB9IGZyb20gXCIuLi9tb2RlbHMvZHJhZy1kcm9wXCI7XHJcbmltcG9ydCB7IFByb2plY3RJdGVtIH0gZnJvbSBcIi4vcHJvamVjdC1pdGVtXCI7XHJcbmltcG9ydCB7IHByb2plY3RTdGF0ZSB9IGZyb20gXCIuLi9zdGF0ZS9wcm9qZWN0LXN0YXRlXCI7XHJcblxyXG4vLyBQcm9qZWN0TGlzdCBDbGFzc1xyXG5leHBvcnQgY2xhc3MgUHJvamVjdExpc3QgZXh0ZW5kcyBDb21wb25lbnQ8SFRNTERpdkVsZW1lbnQsIEhUTUxFbGVtZW50PiBpbXBsZW1lbnRzIERyYWdUYXJnZXQge1xyXG4gIGFzc2lnbmVkUHJvamVjdHM6IFByb2plY3RbXTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSB0eXBlOiBcImFjdGl2ZVwiIHwgXCJmaW5pc2hlZFwiKSB7XHJcbiAgICBzdXBlcihcInByb2plY3QtbGlzdFwiLCBcImFwcFwiLCBmYWxzZSwgYCR7dHlwZX0tcHJvamVjdHNgKTtcclxuICAgIHRoaXMuYXNzaWduZWRQcm9qZWN0cyA9IFtdO1xyXG5cclxuICAgIHRoaXMuY29uZmlndXJlKCk7XHJcbiAgICB0aGlzLnJlbmRlckNvbnRlbnQoKTtcclxuICB9XHJcblxyXG4gIEBhdXRvYmluZFxyXG4gIGRyYWdPdmVySGFuZGxlcihldmVudDogRHJhZ0V2ZW50KSB7XHJcbiAgICBpZiAoZXZlbnQuZGF0YVRyYW5zZmVyICYmIGV2ZW50LmRhdGFUcmFuc2Zlci50eXBlc1swXSA9PT0gXCJ0ZXh0L3BsYWluXCIpIHtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgY29uc3QgbGlzdEVsID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJ1bFwiKSE7XHJcbiAgICAgIGxpc3RFbC5jbGFzc0xpc3QuYWRkKFwiZHJvcHBhYmxlXCIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQGF1dG9iaW5kXHJcbiAgZHJvcEhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCkge1xyXG4gICAgY29uc3QgcHJqSWQgPSBldmVudC5kYXRhVHJhbnNmZXIhLmdldERhdGEoXCJ0ZXh0L3BsYWluXCIpO1xyXG4gICAgcHJvamVjdFN0YXRlLm1vdmVQcm9qZWN0KHByaklkLCB0aGlzLnR5cGUgPT09IFwiYWN0aXZlXCIgPyBQcm9qZWN0U3RhdHVzLkFjdGl2ZSA6IFByb2plY3RTdGF0dXMuRmluaXNoZWQpO1xyXG4gIH1cclxuXHJcbiAgQGF1dG9iaW5kXHJcbiAgZHJhZ0xlYXZlSGFuZGxlcihfOiBEcmFnRXZlbnQpIHtcclxuICAgIGNvbnN0IGxpc3RFbCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwidWxcIikhO1xyXG4gICAgbGlzdEVsLmNsYXNzTGlzdC5yZW1vdmUoXCJkcm9wcGFibGVcIik7XHJcbiAgfVxyXG5cclxuICBjb25maWd1cmUgPSAoKSA9PiB7XHJcbiAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIHRoaXMuZHJhZ092ZXJIYW5kbGVyKTtcclxuICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ2xlYXZlXCIsIHRoaXMuZHJhZ0xlYXZlSGFuZGxlcik7XHJcbiAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgdGhpcy5kcm9wSGFuZGxlcik7XHJcblxyXG4gICAgcHJvamVjdFN0YXRlLmFkZExpc3RlbmVyKChwcm9qZWN0czogUHJvamVjdFtdKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlbGV2YW50UHJvamVjdHMgPSBwcm9qZWN0cy5maWx0ZXIoKHByaikgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT09IFwiYWN0aXZlXCIpIHtcclxuICAgICAgICAgIHJldHVybiBwcmouc3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkFjdGl2ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHByai5zdGF0dXMgPT09IFByb2plY3RTdGF0dXMuRmluaXNoZWQ7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLmFzc2lnbmVkUHJvamVjdHMgPSByZWxldmFudFByb2plY3RzO1xyXG4gICAgICB0aGlzLnJlbmRlclByb2plY3RzKCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICByZW5kZXJDb250ZW50ID0gKCkgPT4ge1xyXG4gICAgY29uc3QgbGlzdElkID0gYCR7dGhpcy50eXBlfS1wcm9qZWN0cy1saXN0YDtcclxuICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwidWxcIikhLmlkID0gbGlzdElkO1xyXG4gICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJoMlwiKSEudGV4dENvbnRlbnQgPSB0aGlzLnR5cGUudG9VcHBlckNhc2UoKSArIFwiUFJPSkVDVFNcIjtcclxuICB9O1xyXG5cclxuICBwcml2YXRlIHJlbmRlclByb2plY3RzKCkge1xyXG4gICAgY29uc3QgbGlzdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7dGhpcy50eXBlfS1wcm9qZWN0cy1saXN0YCkhIGFzIEhUTUxVTGlzdEVsZW1lbnQ7XHJcbiAgICBsaXN0RWwuaW5uZXJIVE1MID0gXCJcIjtcclxuICAgIGZvciAoY29uc3QgcHJqSXRlbSBvZiB0aGlzLmFzc2lnbmVkUHJvamVjdHMpIHtcclxuICAgICAgbmV3IFByb2plY3RJdGVtKHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwidWxcIikhLmlkLCBwcmpJdGVtKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgUHJvamVjdElucHV0IH0gZnJvbSBcIi4vY29tcG9uZW50cy9wcm9qZWN0LWlucHV0XCI7XHJcbmltcG9ydCB7IFByb2plY3RMaXN0IH0gZnJvbSBcIi4vY29tcG9uZW50cy9wcm9qZWN0LWxpc3RcIjtcclxuXHJcbm5ldyBQcm9qZWN0SW5wdXQoKTtcclxubmV3IFByb2plY3RMaXN0KFwiYWN0aXZlXCIpO1xyXG5uZXcgUHJvamVjdExpc3QoXCJmaW5pc2hlZFwiKTtcclxuIl0sInNvdXJjZVJvb3QiOiIifQ==